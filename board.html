<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <title>E-Cal Proof Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css">
  <style>
   :root {
      --ecal-red: #C1272D;
      --ecal-pink: #FF3974;
      --ecal-bg: #000000;
      --ecal-card: #111111;
      --ecal-border: #222222;
      --ecal-text: #f9fafb;
    }

    body {
      background-color: #000;
      color: var(--ecal-text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans Thai", sans-serif;
    }

    .page {
      display: none;
      height: 100vh;
      overflow: hidden;
    }

    .page.active {
      display: block;
    }

    .fade-in {
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .masonry-grid {
      column-count: 2;
      column-gap: 0.75rem;
    }

    .masonry-item {
      break-inside: avoid;
      margin-bottom: 0.75rem;
      border-radius: 0.75rem;
      overflow: hidden;
      background: #111;
    }

    .masonry-item img,
    .masonry-item video {
      width: 100%;
      display: block;
    }

    .media-count-badge {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
    }

    .nav-btn {
      color: #9ca3af;
      font-size: 0.75rem;
    }

    .nav-btn.active {
      color: #f9fafb;
      font-weight: 600;
    }

    .nav-btn.active i {
      color: var(--ecal-pink);
    }

    .media-slider {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #000;
    }

    .media-slider-track {
      display: flex;
      height: 100%;
      transition: transform 0.25s ease;
    }

    .media-slide {
      flex: 0 0 100vw;
      height: 100vh;
      position: relative;
      background: #000;
    }

    .slider-nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      border-radius: 999px;
      padding: 0.4rem;
      color: #fff;
      border: none;
    }

    .slider-nav-btn.prev {
      left: 0.75rem;
    }

    .slider-nav-btn.next {
      right: 0.75rem;
    }

    .slider-dots {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      padding: 0.5rem 0;
    }

    .slider-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #4b5563;
    }

    .slider-dot.active {
      background: var(--ecal-pink);
      width: 18px;
    }

    .heart-icon {
      transition: transform 0.15s ease, fill 0.15s ease, stroke 0.15s ease;
    }

    .heart-icon.liked {
      fill: var(--ecal-pink);
      stroke: var(--ecal-pink);
      transform: scale(1.15);
    }

    .bottom-gradient {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 160px;
      background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
      pointer-events: none;
      z-index: 10;
    }

    .media-overlay-actions {
      position: fixed;
      right: 12px;
      bottom: 150px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
      z-index: 20;
    }

    .media-overlay-actions button {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      color: white;
      font-size: 0.7rem;
    }

    .media-overlay-profile {
      position: fixed;
      left: 16px;
      bottom: 110px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 20;
    }

    .media-overlay-profile img {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,0.8);
    }

    .media-overlay-caption {
      position: fixed;
      left: 16px;
      bottom: 60px;
      right: 16px;
      z-index: 20;
      color: #e5e7eb;
      font-size: 0.8rem;
    }

    .media-close-btn {
      position: fixed;
      top: 16px;
      left: 12px;
      z-index: 30;
      background: rgba(0,0,0,0.6);
      border-radius: 999px;
      padding: 6px;
      color: white;
    }

    .save-pill {
      position: fixed;
      bottom: 16px;
      right: 16px;
      z-index: 30;
      background: var(--ecal-red);
      color: white;
      border-radius: 999px;
      padding: 10px 22px;
      font-weight: 700;
      font-size: 0.9rem;
      box-shadow: 0 8px 30px rgba(0,0,0,0.7);
    }

    .hidden {
      display: none;
    }
  </style>
 </head>
 <body class="bg-black text-white">
  <div id="app" class="max-w-md mx-auto h-screen relative overflow-hidden bg-black">
   <!-- Gallery Page -->
   <div id="gallery-page" class="page active">
    <div class="fade-in h-full overflow-y-auto pb-20">
     <div class="px-4 pt-4 pb-2 flex items-center justify-between">
      <div>
       <h1 class="text-xl font-bold">Proof Board</h1>
       <p class="text-xs text-gray-400 mt-1">‡∏î‡∏π‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡πÜ E-Cal </p>
      </div>
     </div>
     <div class="px-2 pb-4">
      <div class="masonry-grid">
      </div>
     </div>
    </div>
   </div>
   <!-- Saved Page -->
   <div id="saved-page" class="page">
    <div class="fade-in h-full overflow-y-auto pb-20">
     <div class="px-4 pt-4 pb-3 flex items-center justify-between">
      <div>
       <h1 class="text-xl font-bold">Saved</h1>
       <p class="text-xs text-gray-400 mt-1">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ã‡∏ü‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ</p>
      </div>
     </div>
     <div class="px-2 pb-4">
      <div class="masonry-grid" id="saved-masonry-grid">
      </div>
     </div>
    </div>
   </div>
   <!-- Media View Fullscreen -->
   <div id="media-view-page" class="page">
    <div class="media-slider">
     <div id="media-slider-track" class="media-slider-track">
     </div>
    </div>
    <button class="media-close-btn" onclick="navigateTo('gallery-page')">
     <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
      </path>
     </svg>
    </button>
    <div class="bottom-gradient">
    </div>
    <div class="media-overlay-profile">
     <img id="creator-avatar" src="" alt="Profile">
     <div>
      <p id="creator-name" class="font-semibold text-sm">
      </p>
      <p id="post-date" class="text-gray-400 text-xs">
      </p>
     </div>
    </div>
    <div class="media-overlay-caption">
     <h3 id="post-title-detail" class="text-sm font-semibold mb-1">
     </h3>
     <p id="post-description" class="text-xs text-gray-300 line-clamp-2">
     </p>
    </div>
    <div class="media-overlay-actions">
     <button onclick="navigateTo('comments-page')">
      <svg class="w-7 h-7" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
       </path>
      </svg>
      <span id="comment-count" class="text-white font-semibold">
       0
      </span>
     </button>
     <button id="like-btn" onclick="toggleLike()">
      <svg id="heart-icon" class="w-7 h-7 heart-icon" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
       </path>
      </svg>
      <span id="like-count" class="text-white font-semibold">
       0
      </span>
     </button>
    </div>
    <button id="save-btn" onclick="toggleSave()" class="save-pill">
     Save
    </button>
   </div>
   <!-- Comments Page -->
   <div id="comments-page" class="page">
    <div class="fade-in h-full flex flex-col bg-black">
     <div class="px-4 py-4 flex items-center gap-3 border-b border-gray-800">
      <button onclick="backFromComments()" class="p-2 -ml-2">
       <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
        </path>
       </svg>
      </button>
      <div>
       <p class="text-sm font-semibold">
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô
       </p>
       <p id="comments-count-label" class="text-xs text-gray-400">
       </p>
      </div>
     </div>
     <div id="comments-list" class="flex-1 overflow-y-auto px-4 py-3 space-y-3">
     </div>
     <div class="border-t border-gray-800 p-3 bg-black">
      <div class="flex items-end gap-2">
       <textarea id="comment-input" rows="1" class="flex-1 bg-gray-900 text-sm text-white rounded-2xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-500 resize-none" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå...">
       </textarea>
       <button onclick="submitComment()" class="bg-pink-600 hover:bg-pink-700 rounded-full px-4 py-2 text-sm font-semibold">
        ‡∏™‡πà‡∏á
       </button>
      </div>
     </div>
    </div>
   </div>
   <!-- Bottom Navigation Bar -->
   <div class="fixed bottom-0 left-0 right-0 bg-black border-t border-gray-800 px-4 py-3 z-50" style="box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);">
    <div class="flex items-center justify-around max-w-md mx-auto">
     <button id="nav-gallery" onclick="navigateToTab('gallery-page')" class="flex flex-col items-center gap-1 transition-all nav-btn active">
      <i class="fi fi-rr-house-blank text-xl">
      </i>
      <span>
       Gallery
      </span>
     </button>
     <button id="nav-saved" onclick="navigateToTab('saved-page')" class="flex flex-col items-center gap-1 transition-all nav-btn">
      <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z">
       </path>
      </svg>
      <span class="text-xs font-semibold">
       Saved
      </span>
     </button>
    </div>
   </div>
  </div>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js">
  </script>
  <script src="https://unpkg.com/@supabase/supabase-js@2.48.0/dist/umd/supabase.js">
  </script>
  <script>
   const SUPABASE_URL = 'https://lvtdqeerzxpznnayccmb.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx2dGRxZWVyenhwem5uYXljY21iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY4OTMwODQsImV4cCI6MjA1MjQ2OTA4NH0.TJPzlXvMVKzySJ2WFB4Q34W7GVk3dV1VzdnW0gaAIhA';

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: false }
    });

    let allPosts = [];
    let savedPosts = new Set();
    let likedPosts = new Set();
    let currentMediaIndex = 0;
    let currentSlideIndex = 0;
    let currentPostId = null;
    let backFrom = 'gallery-page';

    function navigateTo(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    function navigateToTab(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');

      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      if (pageId === 'gallery-page') {
        document.getElementById('nav-gallery').classList.add('active');
      } else {
        document.getElementById('nav-saved').classList.add('active');
        renderSavedPosts();
      }
    }

    function backFromComments() {
      navigateTo(backFrom || 'media-view-page');
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ===============================
    // Open Media View (Full-farm + Build Slides)
    // ===============================
    function openMediaView(index) {
      currentMediaIndex = index;
      currentSlideIndex = 0;
      const post = allPosts[index];

      currentPostId = post.id;

      const sliderTrack = document.getElementById('media-slider-track');
      sliderTrack.innerHTML = '';
      sliderTrack.style.transform = 'translateX(0)';

      post.media.forEach(media => {
        const slide = document.createElement('div');
        slide.className = 'media-slide';

        slide.style.width = '100vw';
        slide.style.height = '100vh';
        slide.style.overflow = 'hidden';
        slide.style.position = 'relative';
        slide.style.background = 'black';

        if (media.type === 'video') {
          slide.innerHTML = `
        <video 
          src="${media.url}"
          controls
          autoplay
          playsinline
          class="absolute inset-0 w-full h-full object-cover"
        ></video>
      `;
        } else {
          slide.innerHTML = `
        <img 
          src="${media.url}" 
          class="absolute inset-0 w-full h-full object-cover"
        >
      `;
        }

        sliderTrack.appendChild(slide);
      });

      document.getElementById('post-title-detail').textContent = `${post.challengeName} - Day ${post.dayNumber}`;
      document.getElementById('post-description').textContent = post.fullName || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';

      const proofDate = new Date(post.proofDate);
      document.getElementById('post-date').textContent = proofDate.toLocaleDateString('th-TH', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      const creatorAvatar = document.getElementById('creator-avatar');
      creatorAvatar.src = post.profilePictureUrl || 'https://via.placeholder.com/40';
      document.getElementById('creator-name').textContent = post.fullName || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';

      const saveBtn = document.getElementById('save-btn');
      if (savedPosts.has(post.id)) {
        saveBtn.textContent = 'Saved';
        saveBtn.style.background = '#000000';
      } else {
        saveBtn.textContent = 'Save';
        saveBtn.style.background = '#C1272D';
      }

      const heartIcon = document.getElementById('heart-icon');
      if (likedPosts.has(post.id)) {
        heartIcon.classList.add('liked');
      } else {
        heartIcon.classList.remove('liked');
      }

      updateSliderControls();
      loadComments();
      updateLikeCount(post.id);

      backFrom = 'gallery-page';
      navigateTo('media-view-page');
    }

    // ===============================
    // Swipe Gesture (Touch Events)
    // ===============================
    let startX = 0;
    let isSwiping = false;

    const trackEl = document.getElementById('media-slider-track');

    trackEl.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      isSwiping = true;
    });

    trackEl.addEventListener('touchmove', (e) => {
      if (!isSwiping) return;

      const currentX = e.touches[0].clientX;
      const diff = currentX - startX;

      if (diff < -50) {
        goNextSlide();
        isSwiping = false;
      }

      if (diff > 50) {
        goPrevSlide();
        isSwiping = false;
      }
    });

    trackEl.addEventListener('touchend', () => {
      isSwiping = false;
    });

    // ===============================
    // Slide Navigation Functions
    // ===============================
    function goNextSlide() {
      if (currentSlideIndex < allPosts[currentMediaIndex].media.length - 1) {
        currentSlideIndex++;
        updateSliderPosition();
      }
    }

    function goPrevSlide() {
      if (currentSlideIndex > 0) {
        currentSlideIndex--;
        updateSliderPosition();
      }
    }

    function updateSliderPosition() {
      const track = document.getElementById('media-slider-track');
      track.style.transition = "transform 0.25s ease";
      track.style.transform = `translateX(-${currentSlideIndex * 100}vw)`;
    }

    // Render gallery
    function renderGallery() {
      console.log('üé® Rendering gallery with', allPosts.length, 'posts');

      const grid = document.querySelector('#gallery-page .masonry-grid');
      grid.innerHTML = '';

      if (allPosts.length === 0) {
        grid.innerHTML = `
      <div class="col-span-2 text-center py-20">
        <p class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πå</p>
      </div>
    `;
        return;
      }

      allPosts.forEach((post, index) => {
        const div = document.createElement('div');
        div.className = 'masonry-item';
        div.onclick = () => openMediaView(index);

        const firstMedia = post.media[0];
        const mediaCount = post.media.length;

        if (firstMedia && firstMedia.type === 'video') {
          div.innerHTML = `
        <div class="relative" 
             style="height: 300px; background: #000; overflow: hidden; border-radius: 12px;">
          
          <video 
            src="${firstMedia.url}" 
            class="w-full h-full object-cover"
            muted
            playsinline
            preload="metadata"
          ></video>

          <div class="absolute top-2 right-2 bg-black/60 rounded-full p-1">
            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"></path>
            </svg>
          </div>

          ${mediaCount > 1 ? `<div class="media-count-badge">1/${mediaCount}</div>` : ''}
        </div>
      `;
        } else if (firstMedia) {
          div.innerHTML = `
        <div class="relative" style="border-radius: 12px; overflow: hidden;">
          <img src="${firstMedia.url}" 
               alt="Gallery image" 
               class="w-full h-auto block object-cover">

          ${mediaCount > 1 ? `<div class="media-count-badge">1/${mediaCount}</div>` : ''}
        </div>
      `;
        }

        grid.appendChild(div);
      });

      console.log('‚úÖ Gallery rendered successfully');
    }

    function renderSavedPosts() {
      const grid = document.getElementById('saved-masonry-grid');
      grid.innerHTML = '';

      const savedArray = allPosts.filter(p => savedPosts.has(p.id));

      if (savedArray.length === 0) {
        grid.innerHTML = `
      <div class="col-span-2 text-center py-20">
        <p class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
      </div>
    `;
        return;
      }

      savedArray.forEach((post, index) => {
        const div = document.createElement('div');
        div.className = 'masonry-item';

        div.onclick = () => {
          const originalIndex = allPosts.findIndex(p => p.id === post.id);
          if (originalIndex !== -1) openMediaView(originalIndex);
        };

        const firstMedia = post.media[0];
        const mediaCount = post.media.length;

        if (firstMedia && firstMedia.type === 'video') {
          div.innerHTML = `
        <div class="relative" 
             style="height: 300px; background: #000; overflow: hidden; border-radius: 12px;">
          
          <video 
            src="${firstMedia.url}" 
            class="w-full h-full object-cover"
            muted
            playsinline
            preload="metadata"
          ></video>

          <div class="absolute top-2 right-2 bg-black/60 rounded-full p-1">
            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"></path>
            </svg>
          </div>

          ${mediaCount > 1 ? `<div class="media-count-badge">1/${mediaCount}</div>` : ''}
        </div>
      `;
        } else if (firstMedia) {
          div.innerHTML = `
        <div class="relative" style="border-radius: 12px; overflow: hidden;">
          <img src="${firstMedia.url}" 
               alt="Gallery image" 
               class="w-full h-auto block object-cover">

          ${mediaCount > 1 ? `<div class="media-count-badge">1/${mediaCount}</div>` : ''}
        </div>
      `;
        }

        grid.appendChild(div);
      });
    }

    async function fetchPosts() {
      const { data: proofs, error } = await supabaseClient
        .from('user_challenges_proof')
        .select(`
        id,
        line_user_id,
        full_name,
        day_number,
        challenge_name,
        profile_picture_url,
        proof_date,
        proof_media (
          id,
          media_url,
          media_type,
          media_order,
          thumbnail_url
        )
      `)
        .order('proof_date', { ascending: false });

      if (error) {
        console.error('Error fetching proofs', error);
        return;
      }

      allPosts = proofs.map(p => ({
        id: p.id,
        lineUserId: p.line_user_id,
        fullName: p.full_name,
        dayNumber: p.day_number,
        challengeName: p.challenge_name,
        profilePictureUrl: p.profile_picture_url,
        proofDate: p.proof_date,
        media: (p.proof_media || [])
          .sort((a, b) => a.media_order - b.media_order)
          .map(m => ({
            url: m.thumbnail_url || m.media_url,
            originalUrl: m.media_url,
            type: m.media_type
          }))
      }));

      renderGallery();
    }

    async function loadSavedState() {
      savedPosts = new Set();
      likedPosts = new Set();
    }

    async function updateLikeCount(postId) {
      const likeCountEl = document.getElementById('like-count');
      likeCountEl.textContent = likedPosts.has(postId) ? '1' : '0';
    }

    function toggleLike() {
      if (!currentPostId) return;
      if (likedPosts.has(currentPostId)) {
        likedPosts.delete(currentPostId);
      } else {
        likedPosts.add(currentPostId);
      }
      const heartIcon = document.getElementById('heart-icon');
      if (likedPosts.has(currentPostId)) {
        heartIcon.classList.add('liked');
      } else {
        heartIcon.classList.remove('liked');
      }
      updateLikeCount(currentPostId);
    }

    function toggleSave() {
      if (!currentPostId) return;

      const saveBtn = document.getElementById('save-btn');
      if (savedPosts.has(currentPostId)) {
        savedPosts.delete(currentPostId);
        saveBtn.textContent = 'Save';
        saveBtn.style.background = '#C1272D';
      } else {
        savedPosts.add(currentPostId);
        saveBtn.textContent = 'Saved';
        saveBtn.style.background = '#000000';
      }
      renderSavedPosts();
    }

    async function loadComments() {
      if (!currentPostId) return;

      const commentsList = document.getElementById('comments-list');
      commentsList.innerHTML = '<p class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå</p>';
      document.getElementById('comment-count').textContent = '0';
      document.getElementById('comments-count-label').textContent = '0 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô';
    }

    async function submitComment() {
      const textarea = document.getElementById('comment-input');
      const text = textarea.value.trim();
      if (!text || !currentPostId) return;

      textarea.value = '';
      loadComments();
    }

    async function init() {
      navigateTo('gallery-page');
      await loadSavedState();
      await fetchPosts();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
 </body>
</html>
