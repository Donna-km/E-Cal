<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Cal Premium Upgrade</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body { background: #000; font-family: 'Inter', sans-serif; }
    .glass {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
    }
    .plan-selected {
      border: 2px solid #C1272D !important;
      background: rgba(193,39,45,0.15);
    }
    .plan-unselected {
      border: 2px solid rgba(255,255,255,0.15);
    }
    .select-dot {
      width: 22px;
      height: 22px;
      border-radius: 9999px;
      border: 2px solid #aaa;
    }
    .select-dot.active {
      background: #C1272D;
      border-color: #C1272D;
    }
    .premium-btn {
      background: #C1272D;
    }
    .premium-btn:hover {
      background: #a02126;
    }
  </style>
</head>

<body class="text-white">

<!-- LIFF INIT -->
<script>
  let lineUserId = null;
  let liffReady = false;

  async function initLiff() {
    try {
      await liff.init({ liffId: "2007859046-jqRLglRW" });

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      const profile = await liff.getProfile();
      lineUserId = profile.userId;
      liffReady = true;
      console.log("LINE USER ID:", lineUserId);

    } catch (err) {
      console.error("LIFF init error:", err);
    }
  }

  initLiff();
</script>

<!-- Sticker -->
<div class="w-full flex justify-center mt-8 mb-4">
  <img
    src="https://lvtdqeerzxpznnayccmb.supabase.co/storage/v1/object/public/test-pics/ecal_sticker_2.png"
    class="w-56 h-56 object-contain"
    alt="E-Cal Sticker"
  >
</div>

<!-- Headline -->
<div class="px-6 text-center">
  <h1 class="text-2xl font-extrabold mb-2">
    Crush Your Goals ‚Äî E-Cal‚Äôs Got Your Back.
  </h1>
  <p class="text-sm text-gray-300">
    ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ó‡∏∏‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì E-Cal ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏°‡∏≠
  </p>
</div>

<!-- Plan Selection -->
<div class="px-6 mt-8 space-y-4">

  <!-- YEARLY PLAN -->
  <div id="yearlyBox"
       class="glass rounded-2xl p-4 flex justify-between items-center plan-selected cursor-pointer relative"
       onclick="selectPlan('yearly')">

    <div class="absolute -top-3 -left-2">
      <span class="bg-red-600 text-xs font-bold px-3 py-1 rounded-full shadow-lg uppercase tracking-wide">
        Save 44%
      </span>
    </div>

    <div class="mt-2">
      <div class="text-sm text-gray-300">Yearly Starter</div>
      <div class="text-2xl font-bold text-white">‡∏ø83.25/mo</div>
      <div class="text-sm text-gray-400">(‡∏ø999.00/year)</div>
    </div>

    <div class="select-dot active" id="dot-yearly"></div>
  </div>

  <!-- MONTHLY PLAN -->
  <div id="monthlyBox"
       class="glass rounded-2xl p-4 flex justify-between items-center plan-unselected cursor-pointer"
       onclick="selectPlan('monthly')">

    <div>
      <div class="text-sm text-gray-300">Monthly Starter</div>
      <div class="text-2xl font-bold text-white">‡∏ø149.00/mo</div>
    </div>

    <div class="select-dot" id="dot-monthly"></div>
  </div>

</div>

<!-- Benefits -->
<div class="px-6 mt-8 space-y-3 text-sm">
  <div class="flex items-center space-x-3">
    <span class="text-lg">üçΩÔ∏è</span>
    <span class="text-gray-300">Smart Scan ‚Äì ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</span>
  </div>
  <div class="flex items-center space-x-3">
    <span class="text-lg">üéØ</span>
    <span class="text-gray-300">Daily Personalized Mission</span>
  </div>
  <div class="flex items-center space-x-3">
    <span class="text-lg">ü§ñ</span>
    <span class="text-gray-300">Chatbot Support Unlimited ‚Äì ‡∏ñ‡∏≤‡∏°‚Äì‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏≠‡∏±‡πâ‡∏ô</span>
  </div>
  <div class="flex items-center space-x-3">
    <span class="text-lg">üìä</span>
    <span class="text-gray-300">Premium Insights ‚Äì ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å</span>
  </div>
</div>

<!-- CTA BUTTON -->
<div class="mt-10 px-6 mb-10">
  <button id="startBtn"
          class="premium-btn w-full py-4 rounded-full shadow text-xl font-bold">
    Upgrade to Premium
  </button>

  <p id="priceNote" class="text-center mt-3 text-xs text-gray-400">
    ‡∏ø999.00 per year
  </p>
</div>

<script>
  let selectedPlan = "yearly"; // default

  function selectPlan(plan) {
    selectedPlan = plan;

    document.getElementById("yearlyBox").classList.toggle("plan-selected", plan === "yearly");
    document.getElementById("yearlyBox").classList.toggle("plan-unselected", plan !== "yearly");

    document.getElementById("monthlyBox").classList.toggle("plan-selected", plan === "monthly");
    document.getElementById("monthlyBox").classList.toggle("plan-unselected", plan !== "monthly");

    document.getElementById("dot-yearly").classList.toggle("active", plan === "yearly");
    document.getElementById("dot-monthly").classList.toggle("active", plan === "monthly");

    document.getElementById("priceNote").textContent =
      plan === "yearly" ? "‡∏ø999.00 per year" : "‡∏ø149.00 per month";
  }

  async function startCheckout() {
    try {
      if (!liffReady || !lineUserId) {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö LINE User ID ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
        return;
      }

      const plan_name =
        selectedPlan === "monthly" ? "premium_monthly" : "premium_yearly";

      const res = await fetch(
        "https://primary-production-49d9.up.railway.app/webhook/create-session",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            line_user_id: lineUserId,
            plan_name: plan_name
          })
        }
      );

      if (!res.ok) {
        console.error("HTTP error:", res.status);
        alert("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        return;
      }

      const data = await res.json();
      console.log("Session response:", data);

      if (data.url) {
        window.location.href = data.url;
      } else {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô");
      }

    } catch (err) {
      console.error("Checkout error:", err);
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô");
    }
  }

  document.getElementById("startBtn").addEventListener("click", startCheckout);
</script>

</body>
</html>


