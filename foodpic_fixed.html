<!-- ===== E-CAL FOOD: Loading (with Scan Animation) ===== -->
<div id="loadingPage" class="hidden flex flex-col items-center justify-center min-h-screen bg-transparent text-center">

  <div id="scanAreaFood"
       class="relative mx-auto mb-6 overflow-hidden rounded-2xl shadow-xl border border-[#FF3974]/30"
       style="max-width:320px; aspect-ratio:1/1;">

    <!-- üñºÔ∏è ‡∏£‡∏π‡∏õ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
    <img id="scanImageFood"
         src="https://via.placeholder.com/320x320?text=Analyzing+Food..."
         alt="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏´‡∏≤‡∏£..."
         class="w-full h-full object-cover rounded-2xl opacity-95 transition-all duration-500 ease-in-out">

    <!-- üî¥ ‡πÄ‡∏™‡πâ‡∏ô‡∏™‡πÅ‡∏Å‡∏ô -->
    <div class="scan-line"></div>
  </div>

  <p class="text-[#FF3974] font-semibold animate-pulse mt-2">
    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì... üç±
  </p>

  <style>
    .scan-line {
      position: absolute;
      top: -10%;
      left: 0;
      width: 100%;
      height: 6px;
      background: linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 57, 116, 0.9) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      animation: scanMove 1.8s linear infinite;
      border-radius: 6px;
      box-shadow: 0 0 16px rgba(255, 57, 116, 0.8);
    }

    @keyframes scanMove {
      0% { top: -10%; }
      50% { top: 100%; }
      100% { top: -10%; }
    }
  </style>
</div>

<script>
// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Loading ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
window.showFoodLoading = async function (file) {
  const cam = document.getElementById("cameraPage");
  const lb = document.getElementById("loadingPage");
  const img = document.getElementById("scanImageFood");

  if (cam) cam.classList.add("hidden");
  if (lb) lb.classList.remove("hidden");

  const userImage = file || window.__ecalFoodImage || window.selectedImage || null;
  console.log("üß† ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û:", userImage);

  await new Promise((r) => setTimeout(r, 300)); // ‡∏´‡∏ô‡πà‡∏ß‡∏á DOM ‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°

  if (img) {
    if (userImage instanceof File) {
      const blobUrl = URL.createObjectURL(userImage);
      img.src = blobUrl;

      await new Promise((resolve, reject) => {
        img.onload = () => {
          console.log("‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          setTimeout(() => URL.revokeObjectURL(blobUrl), 1000);
          resolve();
        };
        img.onerror = (err) => {
          console.warn("‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
          img.src = "https://via.placeholder.com/320x320?text=Analyzing+Food...";
          reject(err);
        };
      });
    } else if (typeof userImage === "string" && userImage.startsWith("http")) {
      img.src = userImage;
    } else {
      img.src = "https://via.placeholder.com/320x320?text=Analyzing+Food...";
    }
  }
};

document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("foodInput") || document.getElementById("cameraInput") || document.getElementById("galleryInput");
  if (!input) return;

  input.addEventListener("change", async (e) => {
    const file = e.target.files?.[0];
    if (file) {
      window.__ecalFoodImage = file;
      console.log("üì∏ ‡πÑ‡∏î‡πâ‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:", file.name);
      await showFoodLoading(file);
    }
  });
});
</script>
